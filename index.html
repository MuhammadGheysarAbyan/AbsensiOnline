<!DOCTYPE html>
<html lang="id" data-theme="light">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AbsensiQR — Sistem Absensi Modern</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link
    href="https://fonts.googleapis.com/css2?family=Syne:wght@400;600;700;800&family=DM+Sans:wght@300;400;500;600&display=swap"
    rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jsQR/1.4.0/jsQR.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.min.js"></script>
  <link rel="stylesheet" href="assets/css/style.css">
</head>

<body>

  <!-- ═══ LOGIN ═══ -->
  <div class="auth-wrap" id="page-login">
    <div class="auth-art">
      <div class="auth-logo-big">Absensi<span>QR</span></div>
      <div class="auth-tagline">Sistem absensi modern dengan QR Code real-time & dashboard analitik profesional.</div>
      <div class="auth-qr-art">
        <svg width="120" height="120" viewBox="0 0 120 120" xmlns="http://www.w3.org/2000/svg">
          <rect x="10" y="10" width="38" height="38" rx="4" fill="#1a1814" />
          <rect x="18" y="18" width="22" height="22" rx="2" fill="white" />
          <rect x="24" y="24" width="10" height="10" rx="1" fill="#1a1814" />
          <rect x="72" y="10" width="38" height="38" rx="4" fill="#1a1814" />
          <rect x="80" y="18" width="22" height="22" rx="2" fill="white" />
          <rect x="86" y="24" width="10" height="10" rx="1" fill="#1a1814" />
          <rect x="10" y="72" width="38" height="38" rx="4" fill="#1a1814" />
          <rect x="18" y="80" width="22" height="22" rx="2" fill="white" />
          <rect x="24" y="86" width="10" height="10" rx="1" fill="#1a1814" />
          <rect x="55" y="10" width="8" height="8" rx="1" fill="#1a1814" />
          <rect x="55" y="26" width="8" height="8" rx="1" fill="#1a1814" />
          <rect x="55" y="42" width="8" height="8" rx="1" fill="#1a1814" />
          <rect x="10" y="55" width="8" height="8" rx="1" fill="#1a1814" />
          <rect x="26" y="55" width="8" height="8" rx="1" fill="#1a1814" />
          <rect x="42" y="55" width="8" height="8" rx="1" fill="#1a1814" />
          <rect x="58" y="58" width="8" height="8" rx="1" fill="#1a1814" />
          <rect x="74" y="58" width="8" height="8" rx="1" fill="#1a1814" />
          <rect x="90" y="58" width="8" height="8" rx="1" fill="#1a1814" />
          <rect x="106" y="58" width="8" height="8" rx="1" fill="#1a1814" />
          <rect x="58" y="74" width="8" height="8" rx="1" fill="#1a1814" />
          <rect x="74" y="74" width="8" height="8" rx="1" fill="#1a1814" />
          <rect x="58" y="90" width="8" height="8" rx="1" fill="#1a1814" />
          <rect x="90" y="90" width="8" height="8" rx="1" fill="#1a1814" />
          <rect x="74" y="106" width="8" height="8" rx="1" fill="#1a1814" />
          <rect x="90" y="106" width="8" height="8" rx="1" fill="#1a1814" />
          <rect x="106" y="90" width="8" height="8" rx="1" fill="#1a1814" />
        </svg>
      </div>
    </div>
    <div class="auth-form-side">
      <div class="auth-card">
        <div class="auth-title">Selamat Datang 👋</div>
        <div class="auth-sub">Masuk ke akun Anda untuk mencatat kehadiran</div>
        <div class="form-group">
          <label class="form-label">Email / NIP</label>
          <input type="text" class="form-control" id="login-email" placeholder="admin@demo.com" value="admin@demo.com">
        </div>
        <div class="form-group">
          <label class="form-label">Password</label>
          <input type="password" class="form-control" id="login-pass" placeholder="password" value="password">
        </div>
        <div class="form-group">
          <label class="form-label">Login sebagai</label>
          <select class="form-control" id="login-role">
            <option value="admin">👨‍💼 Administrator</option>
            <option value="user">👤 Karyawan / Siswa</option>
          </select>
        </div>
        <button class="btn btn-primary mt2" onclick="doLogin()">🔑 Masuk Sekarang</button>
        <div class="auth-toggle">Belum punya akun? <a onclick="showAuthPage('page-register')">Daftar di sini</a></div>
        <div class="mt2 txs tc" style="text-align:center">Demo Admin: admin@demo.com / password &nbsp;|&nbsp; Demo User:
          budi@demo.com / password</div>
      </div>
    </div>
  </div>

  <!-- ═══ REGISTER ═══ -->
  <div class="auth-wrap" id="page-register" style="display:none">
    <div class="auth-art">
      <div class="auth-logo-big">Absensi<span>QR</span></div>
      <div class="auth-tagline">Bergabunglah dan nikmati kemudahan absensi digital yang modern.</div>
    </div>
    <div class="auth-form-side">
      <div class="auth-card">
        <div class="auth-title">Buat Akun Baru ✨</div>
        <div class="auth-sub">Isi data diri Anda dengan benar</div>
        <div class="form-group">
          <label class="form-label">Nama Lengkap</label>
          <input type="text" class="form-control" id="reg-name" placeholder="Budi Santoso">
        </div>
        <div class="form-group">
          <label class="form-label">Email</label>
          <input type="email" class="form-control" id="reg-email" placeholder="budi@email.com">
        </div>
        <div class="form-group">
          <label class="form-label">NIP / NIS</label>
          <input type="text" class="form-control" id="reg-nip" placeholder="2024001">
        </div>
        <div class="form-group">
          <label class="form-label">Departemen / Kelas</label>
          <input type="text" class="form-control" id="reg-dept" placeholder="XII RPL 1">
        </div>
        <div class="form-group">
          <label class="form-label">Password</label>
          <input type="password" class="form-control" id="reg-pass" placeholder="Min. 8 karakter">
        </div>
        <button class="btn btn-primary mt2" onclick="doRegister()">✅ Daftar Sekarang</button>
        <div class="auth-toggle">Sudah punya akun? <a onclick="showAuthPage('page-login')">Masuk di sini</a></div>
      </div>
    </div>
  </div>

  <!-- ═══ APP SHELL ═══ -->
  <div class="app-shell" id="app-shell">
    <div class="sidebar-backdrop" id="sidebar-backdrop" onclick="closeSidebar()"></div>

    <!-- SIDEBAR ADMIN -->
    <aside class="sidebar" id="sidebar-admin" style="display:none">
      <div class="sidebar-logo">
        <div class="logo-text">Absensi<span>QR</span><span class="logo-badge">Admin</span></div>
      </div>
      <nav class="sidebar-nav">
        <div class="nav-section">
          <div class="nav-section-title">Utama</div>
          <div class="nav-item active" onclick="switchPage('admin-dashboard',this)"><span
              class="nav-icon">📊</span>Dashboard</div>
          <div class="nav-item" onclick="switchPage('admin-qr',this)"><span class="nav-icon">📱</span>Generate QR Code
          </div>
          <div class="nav-item" onclick="switchPage('admin-attendance',this)"><span class="nav-icon">📋</span>Data
            Absensi<span class="nav-badge" id="absent-badge">0</span></div>
        </div>
        <div class="nav-section">
          <div class="nav-section-title">Manajemen</div>
          <div class="nav-item" onclick="switchPage('admin-users',this)"><span class="nav-icon">👥</span>Kelola Pengguna
          </div>
          <div class="nav-item" onclick="switchPage('admin-report',this)"><span class="nav-icon">📈</span>Laporan &
            Export</div>
          <div class="nav-item" onclick="switchPage('admin-settings',this)"><span class="nav-icon">⚙️</span>Pengaturan
          </div>
        </div>
      </nav>
      <div class="sidebar-footer">
        <div class="user-card">
          <div class="user-avatar avatar-admin" id="adm-av">A</div>
          <div class="user-info">
            <div class="user-name" id="adm-name">Administrator</div>
            <div class="user-role">Admin</div>
          </div>
          <button class="logout-btn" onclick="doLogout()" title="Logout">🚪</button>
        </div>
      </div>
    </aside>

    <!-- SIDEBAR USER -->
    <aside class="sidebar" id="sidebar-user" style="display:none">
      <div class="sidebar-logo">
        <div class="logo-text">Absensi<span>QR</span></div>
      </div>
      <nav class="sidebar-nav">
        <div class="nav-section">
          <div class="nav-section-title">Absensi</div>
          <div class="nav-item active" onclick="switchPage('user-dashboard',this)"><span
              class="nav-icon">🏠</span>Beranda</div>
          <div class="nav-item" onclick="switchPage('user-scan',this)"><span class="nav-icon">📸</span>Scan QR Code
          </div>
          <div class="nav-item" onclick="switchPage('user-history',this)"><span class="nav-icon">📅</span>Riwayat Saya
          </div>
          <div class="nav-item" onclick="switchPage('user-profile',this)"><span class="nav-icon">👤</span>Profil</div>
        </div>
      </nav>
      <div class="sidebar-footer">
        <div class="user-card">
          <div class="user-avatar avatar-user" id="usr-av">U</div>
          <div class="user-info">
            <div class="user-name" id="usr-name">User</div>
            <div class="user-role">Karyawan</div>
          </div>
          <button class="logout-btn" onclick="doLogout()" title="Logout">🚪</button>
        </div>
      </div>
    </aside>

    <div class="main-area">
      <header class="topbar">
        <div class="topbar-left">
          <button class="menu-toggle" onclick="toggleSidebar()">☰</button>
          <div class="page-title" id="topbar-title">Dashboard</div>
        </div>
        <div class="topbar-right">
          <div class="topbar-time" id="topbar-clock">--:--:--</div>
          <div class="notif-bell" id="notif-bell" onclick="toggleNotifPanel()" title="Notifikasi">
            <button class="theme-toggle" style="font-size:17px">🔔</button>
            <div class="notif-bell-badge" id="notif-bell-count" style="display:none">0</div>
            <div class="notif-panel" id="notif-panel">
              <div class="notif-panel-header">
                <h4>🔔 Notifikasi</h4><button class="btn btn-ghost btn-sm" onclick="clearNotifPanel(event)"
                  style="padding:4px 8px;font-size:11px">Hapus semua</button>
              </div>
              <div class="notif-panel-body" id="notif-panel-body">
                <div class="cmd-empty">Belum ada notifikasi</div>
              </div>
            </div>
          </div>
          <button class="theme-toggle" onclick="toggleTheme()" title="Dark Mode">🌙</button>
          <div class="cmd-hint" onclick="openCmdPalette()" style="cursor:pointer">⌘K</div>
        </div>
      </header>

      <!-- ADMIN DASHBOARD -->
      <div class="page-content active" id="page-admin-dashboard">
        <div class="stats-grid">
          <div class="stat-card blue">
            <div class="stat-icon blue">👥</div>
            <div class="stat-value" id="s-total">0</div>
            <div class="stat-label">Total Pengguna</div>
            <div class="stat-change up">▲ aktif terdaftar</div>
          </div>
          <div class="stat-card green">
            <div class="stat-icon green">✅</div>
            <div class="stat-value" id="s-hadir">0</div>
            <div class="stat-label">Hadir Hari Ini</div>
            <div class="stat-change up">▲ tepat waktu</div>
          </div>
          <div class="stat-card yellow">
            <div class="stat-icon yellow">⏰</div>
            <div class="stat-value" id="s-telat">0</div>
            <div class="stat-label">Terlambat</div>
            <div class="stat-change down">▼ lebih baik</div>
          </div>
          <div class="stat-card red">
            <div class="stat-icon red">❌</div>
            <div class="stat-value" id="s-alfa">0</div>
            <div class="stat-label">Alfa / Tidak Hadir</div>
            <div class="stat-change down">▲ perhatikan</div>
          </div>
        </div>
        <div class="grid-65-35 mb2">
          <div class="card">
            <div class="card-header">
              <div>
                <div class="card-title">📈 Grafik Kehadiran Mingguan</div>
                <div class="card-subtitle">7 hari terakhir</div>
              </div>
              <select class="filter-input" onchange="updateChart(this.value)">
                <option value="weekly">Mingguan</option>
                <option value="monthly">Bulanan</option>
              </select>
            </div>
            <canvas id="chart-weekly" height="100"></canvas>
          </div>
          <div class="card">
            <div class="card-header">
              <div class="card-title">🍩 Status Hari Ini</div>
            </div>
            <canvas id="chart-donut" height="190"></canvas>
          </div>
        </div>
        <div class="grid-2 mb2">
          <div class="card">
            <div class="card-header">
              <div>
                <div class="card-title">📅 Heatmap Kehadiran</div>
                <div class="card-subtitle">30 hari terakhir</div>
              </div>
            </div>
            <div class="heatmap-wrap" id="heatmap-wrap"></div>
            <div class="heatmap-legend"><span>Sedikit</span>
              <div class="heatmap-cell l1"></div>
              <div class="heatmap-cell l2"></div>
              <div class="heatmap-cell l3"></div>
              <div class="heatmap-cell l4"></div><span>Banyak</span>
            </div>
          </div>
          <div class="card">
            <div class="card-header">
              <div class="card-title">⚡ Aktivitas Terkini</div>
            </div>
            <div class="timeline" id="activity-timeline"></div>
          </div>
        </div>
        <div class="card">
          <div class="card-header">
            <div>
              <div class="card-title">📋 Absensi Terbaru</div>
              <div class="card-subtitle" id="today-label">Hari ini</div>
            </div>
            <button class="btn btn-ghost btn-sm" onclick="switchPage('admin-attendance',null)">Lihat Semua →</button>
          </div>
          <div class="table-wrap">
            <table>
              <thead>
                <tr>
                  <th>#</th>
                  <th>Nama</th>
                  <th>NIP/NIS</th>
                  <th>Check-in</th>
                  <th>Check-out</th>
                  <th>Status</th>
                </tr>
              </thead>
              <tbody id="recent-tbody"></tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- ADMIN QR -->
      <div class="page-content" id="page-admin-qr">
        <div class="grid-2" style="max-width:880px;margin:0 auto">
          <div class="card">
            <div class="card-header">
              <div>
                <div class="card-title">📱 Generate QR Code</div>
                <div class="card-subtitle">Buat QR Code unik untuk sesi absensi</div>
              </div>
            </div>
            <div class="form-group">
              <label class="form-label">Tipe Absensi</label>
              <select class="form-control" id="qr-type">
                <option value="checkin">✅ Check-in (Masuk)</option>
                <option value="checkout">🏁 Check-out (Pulang)</option>
              </select>
            </div>
            <div class="form-group">
              <label class="form-label">Durasi Valid</label>
              <select class="form-control" id="qr-dur">
                <option value="2">2 Menit</option>
                <option value="5">5 Menit</option>
                <option value="10">10 Menit</option>
                <option value="30">30 Menit</option>
              </select>
            </div>
            <div class="form-group">
              <label class="form-label">Lokasi (Opsional)</label>
              <input type="text" class="form-control" id="qr-loc" placeholder="Ruang Kelas A / Kantor Lantai 2">
            </div>
            <button class="btn btn-primary w100" onclick="generateQR()">⚡ Generate QR Code Baru</button>
            <div class="divider"></div>
            <div id="qr-info-box" style="display:none">
              <div class="flex ai-c jb mb1">
                <span class="fw7 ts">QR Code Aktif</span>
                <span class="badge badge-green" id="qr-badge">● Aktif</span>
              </div>
              <div class="qr-info-row">
                <div class="qr-chip">Tipe: <strong id="qi-t">-</strong></div>
                <div class="qr-chip">Lokasi: <strong id="qi-l">-</strong></div>
                <div class="qr-chip">Expired: <strong id="qi-e">-</strong></div>
              </div>
              <div class="progress-bar mt1">
                <div class="progress-fill" id="qr-prog" style="width:100%"></div>
              </div>
              <div class="txs tc mt1" style="text-align:center" id="qr-tleft"></div>
            </div>
          </div>
          <div class="card" style="display:flex;flex-direction:column;align-items:center;gap:18px">
            <div class="card-title" style="align-self:flex-start">🖼️ QR Code Preview</div>
            <div class="qr-wrap">
              <div id="qr-canvas-wrap">
                <div id="qr-display"
                  style="width:200px;height:200px;display:flex;align-items:center;justify-content:center;color:var(--text3);font-size:13.5px;text-align:center;padding:16px">
                  Klik "Generate" untuk membuat QR Code
                </div>
                <div class="qr-exp-overlay" id="qr-exp-overlay">
                  <div style="font-size:36px">⛔</div>
                  <div>QR Code Expired</div>
                </div>
              </div>
              <div class="cr-ring" id="cr-ring" style="display:none">
                <svg width="100" height="100" viewBox="0 0 100 100">
                  <circle class="ring-track" cx="50" cy="50" r="44" />
                  <circle class="ring-progress" id="ring-c" cx="50" cy="50" r="44" stroke-dasharray="276.46"
                    stroke-dashoffset="0" />
                </svg>
                <div class="cr-label">
                  <div class="cr-num" id="cr-n">--</div>
                  <div class="cr-sec">detik</div>
                </div>
              </div>
              <div style="display:flex;gap:8px">
                <button class="btn btn-ghost btn-sm" id="btn-dl" onclick="downloadQR()" style="display:none">⬇️
                  Download</button>
                <button class="btn btn-ghost btn-sm" id="btn-fs" onclick="showQRFullscreen()" style="display:none">🔍
                  Fullscreen</button>
              </div>
            </div>
          </div>
        </div>
        <div class="card mt2">
          <div class="card-header">
            <div class="card-title">📜 Riwayat QR Code</div>
          </div>
          <div class="table-wrap">
            <table>
              <thead>
                <tr>
                  <th>Token</th>
                  <th>Tipe</th>
                  <th>Dibuat</th>
                  <th>Expired</th>
                  <th>Scan</th>
                  <th>Status</th>
                </tr>
              </thead>
              <tbody id="qr-hist"></tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- ADMIN ATTENDANCE -->
      <div class="page-content" id="page-admin-attendance">
        <div class="card">
          <div class="card-header">
            <div>
              <div class="card-title">📋 Data Absensi Lengkap</div>
              <div class="card-subtitle">Filter dan kelola seluruh data absensi</div>
            </div>
            <div style="display:flex;gap:8px">
              <button class="btn btn-ghost btn-sm" onclick="exportPDF()">📄 Export PDF</button>
              <button class="btn btn-ghost btn-sm" onclick="exportExcel()">📊 Export CSV</button>
            </div>
          </div>
          <div class="date-filter mb2">
            <input type="date" class="filter-input" id="f-date" onchange="filterTable()">
            <input type="text" class="filter-input" placeholder="🔍 Cari nama / NIP..." id="f-search"
              oninput="filterTable()">
            <select class="filter-input" id="f-status" onchange="filterTable()">
              <option value="">Semua Status</option>
              <option value="hadir">✅ Hadir</option>
              <option value="telat">⏰ Terlambat</option>
              <option value="alfa">❌ Alfa</option>
            </select>
            <button class="btn btn-ghost btn-sm" onclick="clearFilters()">✕ Reset</button>
          </div>
          <div class="table-wrap">
            <table>
              <thead>
                <tr>
                  <th>#</th>
                  <th>Nama</th>
                  <th>NIP/NIS</th>
                  <th>Departemen</th>
                  <th>Tanggal</th>
                  <th>Check-in</th>
                  <th>Check-out</th>
                  <th>Durasi</th>
                  <th>Status</th>
                  <th>Aksi</th>
                </tr>
              </thead>
              <tbody id="att-tbody"></tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- ADMIN USERS -->
      <div class="page-content" id="page-admin-users">
        <div class="card">
          <div class="card-header">
            <div>
              <div class="card-title">👥 Kelola Pengguna</div>
              <div class="card-subtitle">Daftar semua pengguna terdaftar</div>
            </div>
            <button class="btn btn-primary btn-sm" onclick="openAddUser()">+ Tambah Pengguna</button>
          </div>
          <div class="table-wrap">
            <table>
              <thead>
                <tr>
                  <th>#</th>
                  <th>Nama</th>
                  <th>NIP/NIS</th>
                  <th>Email</th>
                  <th>Departemen</th>
                  <th>Role</th>
                  <th>Status</th>
                  <th>Aksi</th>
                </tr>
              </thead>
              <tbody id="usr-tbody"></tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- ADMIN REPORT -->
      <div class="page-content" id="page-admin-report">
        <div class="stats-grid mb2">
          <div class="stat-card blue">
            <div class="stat-icon blue">📅</div>
            <div class="stat-value" id="r-days">22</div>
            <div class="stat-label">Hari Kerja Bulan Ini</div>
          </div>
          <div class="stat-card green">
            <div class="stat-icon green">📈</div>
            <div class="stat-value" id="r-avg">0%</div>
            <div class="stat-label">Rata-rata Kehadiran</div>
          </div>
          <div class="stat-card yellow">
            <div class="stat-icon yellow">⏱️</div>
            <div class="stat-value" id="r-late">0</div>
            <div class="stat-label">Total Keterlambatan</div>
          </div>
          <div class="stat-card red">
            <div class="stat-icon red">🏆</div>
            <div class="stat-value" id="r-perf">0</div>
            <div class="stat-label">Kehadiran Sempurna</div>
          </div>
        </div>
        <div class="grid-2">
          <div class="card">
            <div class="card-header">
              <div class="card-title">📊 Kehadiran per Minggu (Bulan Ini)</div>
            </div><canvas id="chart-monthly" height="120"></canvas>
          </div>
          <div class="card">
            <div class="card-header">
              <div class="card-title">🏅 Top 5 Kehadiran Terbaik</div>
            </div>
            <div id="top-list"></div>
          </div>
        </div>
      </div>

      <!-- ADMIN SETTINGS -->
      <div class="page-content" id="page-admin-settings">
        <div class="grid-2" style="max-width:780px">
          <div class="card">
            <div class="card-header">
              <div class="card-title">⚙️ Jam Kerja & Toleransi</div>
            </div>
            <div class="form-group"><label class="form-label">Jam Masuk</label><input type="time" class="form-control"
                id="set-ci" value="08:00"></div>
            <div class="form-group"><label class="form-label">Toleransi Keterlambatan (menit)</label><input
                type="number" class="form-control" id="set-tol" value="15" min="0" max="60"></div>
            <div class="form-group"><label class="form-label">Jam Pulang</label><input type="time" class="form-control"
                id="set-co" value="17:00"></div>
            <button class="btn btn-primary" onclick="saveSettings()">💾 Simpan</button>
          </div>
          <div class="card">
            <div class="card-header">
              <div class="card-title">📍 Validasi GPS / Lokasi</div>
            </div>
            <div class="form-group"><label class="form-label">Aktifkan GPS</label>
              <select class="form-control" id="set-gps">
                <option value="off">❌ Nonaktif (Demo)</option>
                <option value="on">✅ Aktif</option>
              </select>
            </div>
            <div class="form-group"><label class="form-label">Radius (meter)</label><input type="number"
                class="form-control" id="set-rad" value="100" min="10" max="1000"></div>
            <div class="form-group"><label class="form-label">Koordinat (Lat, Lng)</label>
              <input type="text" class="form-control" id="set-lat" placeholder="-6.200000">
              <input type="text" class="form-control mt1" id="set-lng" placeholder="106.816666">
            </div>
            <button class="btn btn-primary" onclick="saveSettings()">💾 Simpan Lokasi</button>
          </div>
        </div>
      </div>

      <!-- USER DASHBOARD -->
      <div class="page-content" id="page-user-dashboard">
        <div class="profile-header">
          <div class="profile-avatar-big" id="u-big-av">U</div>
          <div>
            <div class="p-name" id="u-pname">Pengguna</div>
            <div class="p-dept" id="u-pdept">Departemen</div>
            <div class="p-stats">
              <div>
                <div class="p-stat-num" id="u-s-h">0</div>
                <div class="p-stat-lbl">Hari Hadir</div>
              </div>
              <div>
                <div class="p-stat-num" id="u-s-t">0</div>
                <div class="p-stat-lbl">Terlambat</div>
              </div>
              <div>
                <div class="p-stat-num" id="u-s-p">0%</div>
                <div class="p-stat-lbl">Kehadiran</div>
              </div>
            </div>
          </div>
        </div>
        <div class="attend-today">
          <div class="today-card">
            <div class="today-icon in">🟢</div>
            <div>
              <div class="today-time" id="u-ci">--:--</div>
              <div class="today-lbl">Check-in Hari Ini</div>
            </div>
          </div>
          <div class="today-card">
            <div class="today-icon out">🟡</div>
            <div>
              <div class="today-time" id="u-co">--:--</div>
              <div class="today-lbl">Check-out Hari Ini</div>
            </div>
          </div>
        </div>
        <div class="card mb2" id="u-status-card">
          <div class="flex ai-c g3">
            <div id="u-st-icon" style="font-size:30px">📭</div>
            <div>
              <div class="fw7" id="u-st-text">Belum Absen Hari Ini</div>
              <div class="ts tc mt1" id="u-st-sub">Scan QR Code untuk mencatat kehadiran Anda.</div>
            </div>
            <button class="btn btn-primary btn-sm" style="margin-left:auto" onclick="switchPage('user-scan',null)">📸
              Scan Sekarang</button>
          </div>
        </div>
        <div class="card mb2">
          <div class="card-header">
            <div class="card-title">🏆 Penghargaan</div>
            <div class="card-subtitle">Raih pencapaian dengan kehadiran konsisten!</div>
          </div>
          <div class="badge-grid" id="achievements-grid"></div>
        </div>
        <div class="card">
          <div class="card-header">
            <div class="card-title">📅 Riwayat Terbaru</div><button class="btn btn-ghost btn-sm"
              onclick="switchPage('user-history',null)">Lihat Semua →</button>
          </div>
          <div class="table-wrap">
            <table>
              <thead>
                <tr>
                  <th>Tanggal</th>
                  <th>Check-in</th>
                  <th>Check-out</th>
                  <th>Durasi</th>
                  <th>Status</th>
                </tr>
              </thead>
              <tbody id="u-recent"></tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- USER SCAN -->
      <div class="page-content" id="page-user-scan">
        <div style="max-width:500px;margin:0 auto">
          <div class="card mb2">
            <div class="card-title mb1">📷 Scan QR Code Absensi</div>
            <div class="card-subtitle mb2">Arahkan kamera ke QR Code yang ditampilkan admin</div>
            <div id="scan-video-wrap" style="display:none">
              <video id="scan-video" autoplay playsinline muted></video>
              <canvas id="scan-canvas" style="display:none"></canvas>
              <div class="scan-frame">
                <div class="scan-box">
                  <div class="scan-line"></div>
                </div>
              </div>
            </div>
            <div id="scan-ph" style="text-align:center;padding:44px 24px">
              <div style="font-size:60px;margin-bottom:14px">📷</div>
              <div class="fw7 mb1">Kamera belum aktif</div>
              <div class="ts tc mb2">Tekan tombol untuk memulai scan</div>
              <button class="btn btn-primary btn-sm" onclick="startCamera()" style="width:auto">📸 Aktifkan
                Kamera</button>
            </div>
            <div id="scan-res" style="display:none;margin-top:14px">
              <div class="card" id="scan-res-card" style="border:2px solid var(--success)">
                <div style="text-align:center">
                  <div id="sr-icon" style="font-size:44px;margin-bottom:7px">✅</div>
                  <div class="fw7" style="font-size:17px" id="sr-title">Berhasil!</div>
                  <div class="ts tc mt1" id="sr-msg">Kehadiran dicatat.</div>
                  <div class="mt1 fw7" id="sr-time" style="color:var(--accent);font-size:19px">--:--:--</div>
                </div>
              </div>
            </div>
            <div class="mt2" id="gps-box">
              <div class="gps-status gps-checking" id="gps-st"
                style="background:var(--surface2);border:1px solid var(--border)">
                <div class="gps-dot"></div><span id="gps-txt">Memeriksa lokasi GPS...</span>
              </div>
            </div>
            <div style="display:flex;gap:8px;margin-top:14px">
              <button class="btn btn-danger btn-sm w100" onclick="stopCamera()" id="btn-stop" style="display:none">⏹
                Stop Kamera</button>
            </div>
          </div>
          <div class="card">
            <div class="card-title mb2">📲 Cara Scan</div>
            <div style="display:flex;flex-direction:column;gap:11px">
              <div class="flex ai-c g3">
                <div
                  style="width:30px;height:30px;border-radius:50%;background:var(--accent-light);color:var(--accent);display:flex;align-items:center;justify-content:center;font-weight:700;font-size:13px;flex-shrink:0">
                  1</div>
                <div class="ts">Aktifkan kamera dan izinkan akses</div>
              </div>
              <div class="flex ai-c g3">
                <div
                  style="width:30px;height:30px;border-radius:50%;background:var(--accent-light);color:var(--accent);display:flex;align-items:center;justify-content:center;font-weight:700;font-size:13px;flex-shrink:0">
                  2</div>
                <div class="ts">Arahkan ke QR Code yang ditampilkan admin</div>
              </div>
              <div class="flex ai-c g3">
                <div
                  style="width:30px;height:30px;border-radius:50%;background:var(--accent-light);color:var(--accent);display:flex;align-items:center;justify-content:center;font-weight:700;font-size:13px;flex-shrink:0">
                  3</div>
                <div class="ts">Tunggu konfirmasi kehadiran muncul di layar</div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- USER HISTORY -->
      <div class="page-content" id="page-user-history">
        <div class="card">
          <div class="card-header">
            <div class="card-title">📅 Riwayat Absensi Saya</div>
            <div class="date-filter">
              <input type="month" class="filter-input" id="u-f-month" onchange="renderUserHistory()">
            </div>
          </div>
          <div class="table-wrap">
            <table>
              <thead>
                <tr>
                  <th>#</th>
                  <th>Tanggal</th>
                  <th>Hari</th>
                  <th>Check-in</th>
                  <th>Check-out</th>
                  <th>Durasi</th>
                  <th>Status</th>
                </tr>
              </thead>
              <tbody id="u-hist-tbody"></tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- USER PROFILE -->
      <div class="page-content" id="page-user-profile">
        <div style="max-width:580px;margin:0 auto">
          <div class="card mb2">
            <div class="card-title mb2">👤 Profil Saya</div>
            <div class="form-group"><label class="form-label">Nama Lengkap</label><input type="text"
                class="form-control" id="pf-name"></div>
            <div class="form-group"><label class="form-label">Email</label><input type="email" class="form-control"
                id="pf-email"></div>
            <div class="form-group"><label class="form-label">NIP / NIS</label><input type="text" class="form-control"
                id="pf-nip" readonly style="opacity:.6"></div>
            <div class="form-group"><label class="form-label">Departemen</label><input type="text" class="form-control"
                id="pf-dept"></div>
            <button class="btn btn-primary" onclick="saveProfile()">💾 Simpan Perubahan</button>
          </div>
          <div class="card">
            <div class="card-title mb2">🔐 Ubah Password</div>
            <div class="form-group"><label class="form-label">Password Lama</label><input type="password"
                class="form-control" id="pf-op" placeholder="••••••••"></div>
            <div class="form-group"><label class="form-label">Password Baru</label><input type="password"
                class="form-control" id="pf-np" placeholder="Min. 8 karakter"></div>
            <button class="btn btn-ghost" onclick="changePass()">🔑 Ubah Password</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- MODAL -->
  <div class="modal-overlay" id="modal-ol" onclick="closeModalOL(event)">
    <div class="modal" id="modal-box">
      <div class="modal-title" id="m-title">Modal</div>
      <div class="modal-sub" id="m-sub"></div>
      <div id="m-body"></div>
      <div class="modal-actions" id="m-actions">
        <button class="btn btn-ghost btn-sm" onclick="closeModal()">Batal</button>
        <button class="btn btn-primary btn-sm" id="m-ok">Konfirmasi</button>
      </div>
    </div>
  </div>

  <!-- ADD USER MODAL -->
  <div class="modal-overlay" id="add-usr-modal">
    <div class="modal" onclick="event.stopPropagation()">
      <div class="modal-title">👤 Tambah Pengguna</div>
      <div class="modal-sub">Isi data pengguna baru</div>
      <div class="form-group"><label class="form-label">Nama Lengkap</label><input type="text" class="form-control"
          id="nu-name" placeholder="Nama Lengkap"></div>
      <div class="form-group"><label class="form-label">Email</label><input type="email" class="form-control"
          id="nu-email" placeholder="email@domain.com"></div>
      <div class="form-group"><label class="form-label">NIP / NIS</label><input type="text" class="form-control"
          id="nu-nip" placeholder="2024001"></div>
      <div class="form-group"><label class="form-label">Departemen</label><input type="text" class="form-control"
          id="nu-dept" placeholder="XII RPL 1"></div>
      <div class="form-group"><label class="form-label">Password</label><input type="password" class="form-control"
          id="nu-pass" placeholder="••••••••"></div>
      <div class="form-group"><label class="form-label">Role</label><select class="form-control" id="nu-role">
          <option value="user">Karyawan/Siswa</option>
          <option value="admin">Admin</option>
        </select></div>
      <div class="modal-actions">
        <button class="btn btn-ghost btn-sm" onclick="closeAddUser()">Batal</button>
        <button class="btn btn-primary btn-sm" onclick="addUser()">Tambah</button>
      </div>
    </div>
  </div>

  <!-- QR FULLSCREEN -->
  <div class="modal-overlay" id="qr-fs-modal" onclick="closeFS()">
    <div
      style="background:#fff;border-radius:20px;padding:28px;display:flex;flex-direction:column;align-items:center;gap:14px"
      onclick="event.stopPropagation()">
      <div id="qr-fs-display" style="width:280px;height:280px"></div>
      <div class="ts tc">Tunjukkan QR Code ini kepada peserta</div>
      <button class="btn btn-ghost btn-sm" onclick="closeFS()">✕ Tutup</button>
    </div>
  </div>

  <div class="notif-container" id="notif-c"></div>
  <div class="idle-warning" id="idle-w" onclick="this.style.display='none'">⚠️ Sesi hampir habis! Klik untuk lanjutkan.
  </div>

  <!-- FAB -->
  <div class="fab-container" id="fab-container" style="display:none">
    <button class="fab-main" id="fab-main" onclick="toggleFAB()">＋</button>
    <div class="fab-actions" id="fab-actions"></div>
  </div>

  <!-- COMMAND PALETTE -->
  <div class="cmd-overlay" id="cmd-overlay" onclick="closeCmdPalette()">
    <div class="cmd-box" onclick="event.stopPropagation()">
      <div class="cmd-input-wrap">
        <span>🔍</span>
        <input class="cmd-input" id="cmd-input" placeholder="Cari halaman, aksi, atau pengguna..." oninput="filterCmd()"
          onkeydown="cmdKeyDown(event)">
        <div class="cmd-hint">ESC</div>
      </div>
      <div class="cmd-results" id="cmd-results"></div>
    </div>
  </div>

  <script src="assets/js/main.js"></script>
</body>

</html>
